<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.28">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Agriculture, 170 ans d’histoire</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="funathon_agriculture_histoire_files/libs/clipboard/clipboard.min.js"></script>
<script src="funathon_agriculture_histoire_files/libs/quarto-html/quarto.js"></script>
<script src="funathon_agriculture_histoire_files/libs/quarto-html/popper.min.js"></script>
<script src="funathon_agriculture_histoire_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="funathon_agriculture_histoire_files/libs/quarto-html/anchor.min.js"></script>
<link href="funathon_agriculture_histoire_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="funathon_agriculture_histoire_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="funathon_agriculture_histoire_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="funathon_agriculture_histoire_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="funathon_agriculture_histoire_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objectifs" id="toc-objectifs" class="nav-link active" data-scroll-target="#objectifs">Objectifs</a></li>
  <li><a href="#déroulement-du-sujet" id="toc-déroulement-du-sujet" class="nav-link" data-scroll-target="#déroulement-du-sujet">Déroulement du sujet</a></li>
  <li><a href="#rappel-sur-lutilisation-dun-document-quarto" id="toc-rappel-sur-lutilisation-dun-document-quarto" class="nav-link" data-scroll-target="#rappel-sur-lutilisation-dun-document-quarto">Rappel sur l’utilisation d’un document quarto</a></li>
  <li><a href="#configuration-de-notre-script" id="toc-configuration-de-notre-script" class="nav-link" data-scroll-target="#configuration-de-notre-script">Configuration de notre script</a></li>
  <li><a href="#découverte-du-jeu-de-données" id="toc-découverte-du-jeu-de-données" class="nav-link" data-scroll-target="#découverte-du-jeu-de-données">1 - Découverte du jeu de données</a></li>
  <li><a href="#trouver-les-coordonnées-géographiques-des-chefs-lieux-de-canton-utilisation-dune-api" id="toc-trouver-les-coordonnées-géographiques-des-chefs-lieux-de-canton-utilisation-dune-api" class="nav-link" data-scroll-target="#trouver-les-coordonnées-géographiques-des-chefs-lieux-de-canton-utilisation-dune-api">2 - Trouver les coordonnées géographiques des chefs-lieux de canton (utilisation d’une API)</a>
  <ul class="collapse">
  <li><a href="#coordonnées-spatiales-des-chefs-lieux-de-canton-via-lapi-geo.api.gouv.fr" id="toc-coordonnées-spatiales-des-chefs-lieux-de-canton-via-lapi-geo.api.gouv.fr" class="nav-link" data-scroll-target="#coordonnées-spatiales-des-chefs-lieux-de-canton-via-lapi-geo.api.gouv.fr">Coordonnées spatiales des chefs-lieux de canton via l’api : geo.api.gouv.fr</a></li>
  </ul></li>
  <li><a href="#créer-le-découpage-géographique-sur-mesure" id="toc-créer-le-découpage-géographique-sur-mesure" class="nav-link" data-scroll-target="#créer-le-découpage-géographique-sur-mesure">3 - Créer le découpage géographique sur-mesure</a>
  <ul class="collapse">
  <li><a href="#comment-découper-le-territoire" id="toc-comment-découper-le-territoire" class="nav-link" data-scroll-target="#comment-découper-le-territoire">Comment découper le territoire</a></li>
  <li><a href="#découpage-géographique-grâce-au-diagramme-de-voronoi-en-r" id="toc-découpage-géographique-grâce-au-diagramme-de-voronoi-en-r" class="nav-link" data-scroll-target="#découpage-géographique-grâce-au-diagramme-de-voronoi-en-r">Découpage géographique grâce au diagramme de Voronoi en R</a></li>
  <li><a href="#amélioration-du-découpage-géographique" id="toc-amélioration-du-découpage-géographique" class="nav-link" data-scroll-target="#amélioration-du-découpage-géographique">Amélioration du découpage géographique</a></li>
  </ul></li>
  <li><a href="#visualisation-simple-des-données" id="toc-visualisation-simple-des-données" class="nav-link" data-scroll-target="#visualisation-simple-des-données">4 - Visualisation simple des données</a>
  <ul class="collapse">
  <li><a href="#jointure-données-et-fond-géographique" id="toc-jointure-données-et-fond-géographique" class="nav-link" data-scroll-target="#jointure-données-et-fond-géographique">Jointure données et fond géographique</a></li>
  <li><a href="#cartes-en-r" id="toc-cartes-en-r" class="nav-link" data-scroll-target="#cartes-en-r">Cartes en R</a></li>
  </ul></li>
  <li><a href="#visualisation-avancée-des-données" id="toc-visualisation-avancée-des-données" class="nav-link" data-scroll-target="#visualisation-avancée-des-données">5 - Visualisation avancée des données</a>
  <ul class="collapse">
  <li><a href="#présentation-dobservable" id="toc-présentation-dobservable" class="nav-link" data-scroll-target="#présentation-dobservable">Présentation d’Observable</a></li>
  <li><a href="#prise-en-main" id="toc-prise-en-main" class="nav-link" data-scroll-target="#prise-en-main">Prise en main</a></li>
  <li><a href="#création-dune-page-observable-sur-le-recensement-1852" id="toc-création-dune-page-observable-sur-le-recensement-1852" class="nav-link" data-scroll-target="#création-dune-page-observable-sur-le-recensement-1852">Création d’une page observable sur le recensement 1852</a></li>
  <li><a href="#création-dun-chunk-observable-en-r" id="toc-création-dun-chunk-observable-en-r" class="nav-link" data-scroll-target="#création-dun-chunk-observable-en-r">Création d’un chunk observable en R</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Agriculture, 170 ans d’histoire</h1>
<p class="subtitle lead">Produire un fond cartographique à l’aide de données historiques</p>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="objectifs" class="level2">
<h2 class="anchored" data-anchor-id="objectifs">Objectifs</h2>
<p>Mieux connaitre les pratiques agricoles de 1852, période où la France est très rurale et agricole. L’exode rural commence à peine et l’urbanisation est limitée. En spatialisant les données du recensement de 1852, vous déterminerez si les productions étaient régionalisées. Vous pourrez faire le pont avec les donnés de 2020 pour tenter une comparaison.</p>
<p>En travaillant sur ce sujet vous apprendrez à :</p>
<ul>
<li>Interroger une api pour géolocaliser des données</li>
<li>Créer un découpage géographique hors des limites administratives</li>
<li>Visualiser des données géographiques</li>
<li>Créer un dataviz sur Observable (https://observablehq.com/) ou en local</li>
</ul>
</section>
<section id="déroulement-du-sujet" class="level2">
<h2 class="anchored" data-anchor-id="déroulement-du-sujet">Déroulement du sujet</h2>
<ol type="1">
<li>Découverte du jeu de données</li>
<li>Trouver les coordonnées géographiques des chefs-lieux de canton (utilisation d’une API)</li>
<li>Créer le découpage géographique sur-mesure</li>
<li>Visualisation simple des données</li>
<li>Visualisation avancée des données</li>
</ol>
</section>
<section id="rappel-sur-lutilisation-dun-document-quarto" class="level2">
<h2 class="anchored" data-anchor-id="rappel-sur-lutilisation-dun-document-quarto">Rappel sur l’utilisation d’un document quarto</h2>
<p>Dans ce sujet nous vous proposons d’utiliser un document quarto qui est le successeur de Rmarkdown. Le principe est de mélanger du texte (Markdown) et des bouts de code que l’on appelle des <strong>chunks</strong> (code R, Python, Observable…). Le bouton <em>Render</em> permet de produire un document en exécutant les chunks et en transformant le markdown en texte mis en forme. Les formats de sortie sont html, pdf, docx, présentation…</p>
<p>Rstudio propose 2 manières de consulter/modifier un doc quarto :<br>
- Visual : aide à la saise du Markdown et de création des chunks - Source : que du code, moins facile à prendre en main mais plus <em>pur</em></p>
<p>Les chunks doivent être nommées et des paramètres peuvent être précisées, voir ici : https://quarto.org/docs/computations/r.html</p>
<p>En haut à droite de chaque chunk vous avez 2 boutons. Le premier permet de rejouer tous les chunks qui précèdent le chunk. L’autre permet de jouer le chunk (possible aussi en faisant CTRL + MAJ + ENTREE avec le curseur dans le chunk).</p>
<p>Nous vous proposons de travailler dans les chunks proposés et d’en créer d’autres à votre guise. Attention chaque chunk doit avoir un nom unique. Pensez à faire régulièrement un <em>Render</em> afin de vous assurer que votre code complet compile bien.</p>
</section>
<section id="configuration-de-notre-script" class="level2">
<h2 class="anchored" data-anchor-id="configuration-de-notre-script">Configuration de notre script</h2>
<p>La première étape en Quarto est de créer un <em>chunk</em> de setup où l’on appelle les librairies utiles et les éventuelles options. Si jamais des librairies utilisées ici ne sont pas installées dans votre instance de R, nous vous recommandons de les installer dès à présent.</p>
<div class="cell">

</div>
</section>
<section id="découverte-du-jeu-de-données" class="level2">
<h2 class="anchored" data-anchor-id="découverte-du-jeu-de-données">1 - Découverte du jeu de données</h2>
<p>Les données proviennent de <a href="https://journals.openedition.org/acrh/3696">l’enquête agricole de 1852</a>. Notre analyse porte sur les cultures diverses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>surfaces_ra1852 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(<span class="fu">here</span>(<span class="st">'data/cultures_diverses_RA1852_recap.csv'</span>), </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">delim=</span><span class="st">';'</span>,  </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">skip =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">canton =</span> <span class="fu">str_trim</span>(canton)) <span class="do">## supprimer les espaces en fin et en début de chaine</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(surfaces_ra1852)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      code          canton          departement           cereales     
 Min.   : 10.0   Length:449         Length:449         Min.   :     0  
 1st Qu.:230.0   Class :character   Class :character   1st Qu.: 32914  
 Median :444.0   Mode  :character   Mode  :character   Median : 46625  
 Mean   :447.5                                         Mean   : 68438  
 3rd Qu.:652.0                                         3rd Qu.: 66606  
 Max.   :895.0                                         Max.   :350094  
 racines_et_legumes_divers cultures_diverses prairies_artificielles
 Min.   :    0             Min.   :   64     Min.   :    0         
 1st Qu.: 2329             1st Qu.: 1177     1st Qu.: 2847         
 Median : 4345             Median : 2258     Median : 6492         
 Mean   : 7333             Mean   : 4120     Mean   :11419         
 3rd Qu.: 8823             3rd Qu.: 4612     3rd Qu.:13271         
 Max.   :71794             Max.   :59763     Max.   :99799         
    jacheres      total_des_terres_labourables prairies_naturelles
 Min.   :     0   Min.   :   302               Min.   :     0     
 1st Qu.:  8443   1st Qu.: 55170               1st Qu.:  7035     
 Median : 16230   Median : 77220               Median : 14059     
 Mean   : 25412   Mean   :116723               Mean   : 22527     
 3rd Qu.: 30398   3rd Qu.:122937               3rd Qu.: 26906     
 Max.   :168331   Max.   :621280               Max.   :225210     
     vignes       autres_cultures_arborescentes   paturages     
 Min.   :     0   Min.   :    0                 Min.   :     0  
 1st Qu.:   342   1st Qu.:  212                 1st Qu.:  2720  
 Median :  4128   Median :  844                 Median : 10822  
 Mean   :  9760   Mean   : 4450                 Mean   : 29310  
 3rd Qu.: 12054   3rd Qu.: 3111                 3rd Qu.: 34342  
 Max.   :137706   Max.   :85823                 Max.   :383156  
 autres_surfaces_ecoumene superficie_totale
 Min.   :  3122           Min.   :  3424   
 1st Qu.: 19681           1st Qu.:116238   
 Median : 32970           Median :154466   
 Mean   : 53437           Mean   :236206   
 3rd Qu.: 59352           3rd Qu.:223004   
 Max.   :440353           Max.   :974032   
 marais_susceptibles_d_etre_desseches
 Min.   :    0.0                     
 1st Qu.:   16.0                     
 Median :  189.0                     
 Mean   :  913.8                     
 3rd Qu.: 1009.0                     
 Max.   :13571.0                     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(surfaces_ra1852)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 16
   code canton  depart…¹ cerea…² racin…³ cultu…⁴ prair…⁵ jache…⁶ total…⁷ prair…⁸
  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1    10 AIN     &lt;NA&gt;      176685   18993   10288   19390   24366  249722   83897
2    11 BELLEY  AIN        40136    3298    1174    4610    5772   54990   15334
3    12 BOURG   AIN        58528    7410    3706    5076    1668   76388   30692
4    13 GEX     AIN         6611    1069     546    2596     780   11602    8188
5    14 NANTUA  AIN        19347    2262     437    2123    4439   28608   14759
6    15 TREVOUX AIN        52063    4954    4425    4985   11707   78134   14924
# … with 6 more variables: vignes &lt;dbl&gt;, autres_cultures_arborescentes &lt;dbl&gt;,
#   paturages &lt;dbl&gt;, autres_surfaces_ecoumene &lt;dbl&gt;, superficie_totale &lt;dbl&gt;,
#   marais_susceptibles_d_etre_desseches &lt;dbl&gt;, and abbreviated variable names
#   ¹​departement, ²​cereales, ³​racines_et_legumes_divers, ⁴​cultures_diverses,
#   ⁵​prairies_artificielles, ⁶​jacheres, ⁷​total_des_terres_labourables,
#   ⁸​prairies_naturelles</code></pre>
</div>
</div>
<p><em>A noter : dans le répertoire data, nous avons mis l’ensemble des données et le dictionnaire des données. A importer ici si vous souhaitez allez plus loin</em></p>
<p><strong>Les surfaces sont exprimées en hectares.</strong></p>
<p>Nous vous proposons de regarder le jeu de données des surfaces_ra1852.<br>
Vous constatez que :</p>
<ul>
<li>les données sont présentées au niveau départemental et des cantons (selon le chef-lieu). <strong>Attention aux doubles comptes dans vos analyses !</strong></li>
<li>les départements et les cantons ne sont pas les mêmes que ceux que l’on connait actuellement. Le défi est ici : représenter spatialement les données alors que l’on n’a pas de fond de plan avec le découpage des cantons de 1852.</li>
</ul>
<p>Pour s’amuser avec les données, afficher le tableau des surfaces de votre canton (pour nous c’est “Toulouse”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mon_canton <span class="ot">&lt;-</span> surfaces_ra1852 <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(canton <span class="sc">==</span> <span class="st">"TOULOUSE"</span>) <span class="sc">%&gt;%</span> <span class="do">### Changer ici avec votre canton</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(code, canton, departement)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(code, canton, departement)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   name                                  value
   &lt;chr&gt;                                 &lt;dbl&gt;
 1 cereales                              59353
 2 racines_et_legumes_divers              6467
 3 cultures_diverses                      3192
 4 prairies_artificielles                10621
 5 jacheres                              23075
 6 total_des_terres_labourables         102708
 7 prairies_naturelles                    8347
 8 vignes                                21803
 9 autres_cultures_arborescentes            43
10 paturages                              5143
11 autres_surfaces_ecoumene              21290
12 superficie_totale                    159334
13 marais_susceptibles_d_etre_desseches      0</code></pre>
</div>
</div>
<p>Alors quelle est le type de terre labourable la plus étendue ? Chez nous ce sont les céréales.<br>
Avez-vous un peu de vigne ?</p>
<p>Vous vérifierez que :<br>
- cereales + racines_et_legumes_divers + cultures_diverses + prairies_artificielles + jacheres = total_des_terres_labourables<br>
- total_des_terres_labourables + prairies_naturelles + vignes + autres_cultures_arborescentes + paturages + autres_surfaces_ecoumene = superficie_totale</p>
</section>
<section id="trouver-les-coordonnées-géographiques-des-chefs-lieux-de-canton-utilisation-dune-api" class="level2">
<h2 class="anchored" data-anchor-id="trouver-les-coordonnées-géographiques-des-chefs-lieux-de-canton-utilisation-dune-api">2 - Trouver les coordonnées géographiques des chefs-lieux de canton (utilisation d’une API)</h2>
<p>Pour construire les cartes, nous avons besoin de placer les chefs-lieux de canton sur la carte. Pour cela nous allons :</p>
<ul>
<li>obtenir les coordonnées spatiales des chefs-lieux de canton via l’api : geo.api.gouv.fr</li>
<li>transformer notre dataframe en dataframe géographiques</li>
</ul>
<section id="coordonnées-spatiales-des-chefs-lieux-de-canton-via-lapi-geo.api.gouv.fr" class="level3">
<h3 class="anchored" data-anchor-id="coordonnées-spatiales-des-chefs-lieux-de-canton-via-lapi-geo.api.gouv.fr">Coordonnées spatiales des chefs-lieux de canton via l’api : geo.api.gouv.fr</h3>
<p><em>Qu’est-ce qu’une API ?</em></p>
<p>Pour résumer c’est un ensemble de services, d’outils mis à disposition et accessibles via Internet. Dans notre cas on a à disposition une api qui nous permet d’avoir plein d’informations sur une ville : son département, son code région, ses codes postaux, sa population… et les <em>coordonnées de son centre</em>.</p>
<p>Les services d’une API sont généralement utilisables sur une interface web mais également en ligne de codes ou dans un programme informatique (en R, python…).</p>
<section id="tester-lapi-en-ligne" class="level4">
<h4 class="anchored" data-anchor-id="tester-lapi-en-ligne">Tester l’API en ligne</h4>
<p>Pour commencer, regardons comment marche l’api. Nous vous proposons de consulter le site : <a href="https://geo.api.gouv.fr/decoupage-administratif/communes" class="uri">https://geo.api.gouv.fr/decoupage-administratif/communes</a></p>
<p>Là vous faites une recherche par code postal et regardez le résultat dans la fenêtre.</p>
<p>Puis vous faites une recherche par nom et regardez le résultat dans la fenêtre. C’est ce service que nous utiliserons car dans le jeu de données nous avons le nom des villes.<br>
Vous pouvez copier la ligne de commande générée car nous en aurons besoin plus tard. Elle ressemble à</p>
<pre><code>curl 'https://geo.api.gouv.fr/communes?nom=Toulouse&amp;fields=departement&amp;boost=population&amp;limit=5' </code></pre>
</section>
<section id="tester-lapi-dans-un-terminal" class="level4">
<h4 class="anchored" data-anchor-id="tester-lapi-dans-un-terminal">Tester l’API dans un Terminal</h4>
<p>Dans Rstudio, vous allez dans l’onglet Terminal et vous coller la ligne de commande copié précédemment.<br>
Supprimez tout ce qu’il y a après le nom de la ville recherchée.<br>
Astuce : pour coller dans un terminal le “CTRL + V” ne fonctionne pas. Il faut faire un clic droit et choisir “Paste”.</p>
<p>Par exemple :</p>
<pre><code>curl "https://geo.api.gouv.fr/communes?nom=Toulouse"</code></pre>
<p>Qu’est ce qui se passe ?</p>
<p>Vous constatez que l’API nous donne des informations formatées de manière peu lisible… Mais avec un peu de concentration, on s’aperçoit que l’on obtient les infos suivantes :</p>
<ul>
<li>nom : Toulouse<br>
</li>
<li>code : 31555<br>
</li>
<li>codeDepartement : 31<br>
</li>
<li>siren : 213105554<br>
</li>
<li>codeEpci : 243100518<br>
</li>
<li>codeRegion : 76<br>
</li>
<li>codesPostaux : [“31000),”31100),“31200),”31300),“31400),”31500”]<br>
</li>
<li>population : 493465<br>
</li>
<li>_score : 1</li>
</ul>
<p>On est content d’avoir des informations sur Toulouse. Mais nous constatons que nous avons également des informations sur d’autres villes qui ont Toulouse dans leur nom comme Toulouse-Le-Château et Vieille-Toulouse.<br>
Nous constatons également que nous ne récupérons pas les coordonnées du centroid de la Ville. Il nous faudra l’ajouter dans la requête.<br>
Nous voyons également une variable qui s’appelle “_score”. Cette variable nous sera très utile pour la suite.</p>
</section>
<section id="optimiser-la-requête-pour-avoir-les-informations-pertinentes-pour-la-ville-recherchée." class="level4">
<h4 class="anchored" data-anchor-id="optimiser-la-requête-pour-avoir-les-informations-pertinentes-pour-la-ville-recherchée.">Optimiser la requête pour avoir les informations pertinentes pour la ville recherchée.</h4>
<p>On va dans un premier temps ajouter le code du département car nous l’avons dans notre jeu de données. Cela limitera le nombre de villes remontées.</p>
<pre><code>Toujours dans le terminal :
curl "https://geo.api.gouv.fr/communes?nom=Toulouse&amp;codeDepartement=31"</code></pre>
<p>En sortie, on a moins de propositions mais toujours trop. Pour régler cela, nous allons utiliser les paramètres suivants : - boost = population –&gt; cela permet de prioriser les résultats avec une plus grande population, ce qui est pertinent dans notre cas. - limit = 1 –&gt; on ne veut qu’une ville, celle qui a le score le plus élevée (grâce à boost = population)</p>
<p>Et pour avoir les coordonnées du centre la vill, on ajoute : fields=centre</p>
<pre><code>Toujours dans le terminal :

curl "https://geo.api.gouv.fr/communes?nom=Toulouse&amp;codeDepartement=31&amp;fields=centre&amp;boost=population&amp;limit=1"</code></pre>
<p>On obtient bien les coordonnées du centre de Toulouse : “coordinates”:[1.4328,43.6007].</p>
<p>Pour vérifier on peut utiliser google maps, en mettant directement les coordonnées dans l’url après le @ : <a href="https://www.google.fr/maps/@43.6007,1.4328,13.5z">https://www.google.fr/maps/<span class="citation" data-cites="43.6007">@43.6007</span>,1.4328,13.5z</a> (le 13.5z est le zoom)</p>
</section>
<section id="interroger-lapi-geo.api.gouv.fr-sous-r" class="level4">
<h4 class="anchored" data-anchor-id="interroger-lapi-geo.api.gouv.fr-sous-r">Interroger l’api : geo.api.gouv.fr sous R</h4>
<p>Il y a plusieurs possibilités, ici on va utiliser le package <em>jsonlite :</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Création de l'URL</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Sachant que l'on va devoir ensuite faire la requête pour tous les chefs-lieu de canton, on propose une requête type avec 2 champs à completer. Les champs à compléter sont %s</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="st">"https://geo.api.gouv.fr/communes?nom=%s&amp;codeDepartement=%s&amp;fields=centre&amp;boost=population&amp;limit=1"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On utilise la fonction sprintf qui prend une chaine de caractères 'url' et qui va remplacer les %s par les paramètres passées ensuite dans l'ordre. Le premier %s est remplacé par "Toulouse), le second par "31"</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>url_completed <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(url, <span class="st">"Toulouse"</span>, <span class="st">"31"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># on interroge l'API qui est renvoit un JSON qui est convertie en dataframe grâce à la fonction fromJSON</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>resultat <span class="ot">&lt;-</span>  <span class="fu">fromJSON</span>(url_completed)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  centre.type centre.coordinates      nom  code  _score
1       Point    1.4328, 43.6007 Toulouse 31555 5.93465</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultat<span class="sc">$</span>centre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   type     coordinates
1 Point 1.4328, 43.6007</code></pre>
</div>
</div>
</section>
<section id="trouver-les-coordonnées-des-chefs-lieux-des-cantaons" class="level4">
<h4 class="anchored" data-anchor-id="trouver-les-coordonnées-des-chefs-lieux-des-cantaons">Trouver les coordonnées des chefs lieux des cantaons</h4>
<p>On sait trouver le centre pour une ville (avec son département). Maintenant à vous de jouer pour ajouter les colonnes suivantes au jeu de données ra Votre travail consiste à rajouter 2 colonnes, le nom et les coordonnées du centre à la table surfaces_ra1852 :</p>
<ul>
<li>code département</li>
<li>centre</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vérifier-les-coordonnées-des-chefs-lieux-des-cantons" class="level4">
<h4 class="anchored" data-anchor-id="vérifier-les-coordonnées-des-chefs-lieux-des-cantons">Vérifier les coordonnées des chefs lieux des cantons</h4>
<p>Dans le code précédent, nous avons été confrontés à la gestion de NA… Nous vous proposons ici de les identifier et de mettre à jour les coordonnées de ces lieux.</p>
<p>Il se peut que des coordonnées de chefs-lieux ne soient pas trouvés. Identifiez-le et corrigez-les en mettant à jour la colonne centre avec les vecteurs de coordonnées de la ville recherchée.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="créer-les-colonnes-latitude-et-longitude-à-partir-de-la-colonne-centre" class="level4">
<h4 class="anchored" data-anchor-id="créer-les-colonnes-latitude-et-longitude-à-partir-de-la-colonne-centre">Créer les colonnes latitude et longitude à partir de la colonne centre</h4>
<p>Il ne vous reste plus qu’à séparer la colonne centre pour avoir la latitude et la longitude.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vérification-de-lemplacement-des-chefs-lieu-de-canton" class="level4">
<h4 class="anchored" data-anchor-id="vérification-de-lemplacement-des-chefs-lieu-de-canton">Vérification de l’emplacement des chefs-lieu de canton</h4>
<p>Pour vérifier le résultat de notre travail, et pour vérifier également la répartition géographique des cantons, nous vous proposons de réaliser une carte avec un point pour chaque canton.<br>
Utilisez la méthode que vous préférez.</p>
<p>Si vous ne savez pas comment faire, vous pouvez utiliser leaflet avec des markers. La librairie leaflet a été chargée dans le chunk de setup. Il ne vous reste plus qu’à créer le code en vous inspirant de l’aide de leaflet : <a href="https://rstudio.github.io/leaflet/markers.html">Aide Leaflet</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="créer-le-découpage-géographique-sur-mesure" class="level2">
<h2 class="anchored" data-anchor-id="créer-le-découpage-géographique-sur-mesure">3 - Créer le découpage géographique sur-mesure</h2>
<section id="comment-découper-le-territoire" class="level3">
<h3 class="anchored" data-anchor-id="comment-découper-le-territoire">Comment découper le territoire</h3>
<p>Le problème est le suivant :<br>
- nous avons une surface géographique que l’on souhaite découper en zone (des cantons). - nous connaissons le chef lieu de chaque zone. Ce n’est pas forcément le centre mais en tant que chef-lieu, nous considérons qu’il sa zone d’influence l’entoure. - nous n’avons pas d’autres éléments de connaissance sur les zones d’influence.</p>
<p>Notre hypothèse est la suivante : nous coupons la surface du territoire en zone d’influence selon le principe du diagramme de Voronoi :</p>
<p><em>“En mathématiques, un diagramme de Voronoï est un pavage (découpage) du plan en cellules (régions adjacentes) à partir d’un ensemble discret de points appelés « germes ». Chaque cellule enferme un seul germe, et forme l’ensemble des points du plan plus proches de ce germe que d’aucun autre. La cellule représente en quelque sorte la « zone d’influence » du germe.</em></p>
<p><em>Le diagramme doit son nom au mathématicien russe Gueorgui Voronoï (1868-1908). Le découpage est aussi appelé décomposition de Voronoï, partition de Voronoï ou tessellation de Dirichlet.</em></p>
<p><em>De manière plus générale, il représente une décomposition d’un espace métrique en cellules (régions adjacentes), déterminée par les distances à un ensemble discret d’objets de l’espace, en général un ensemble discret de points. Dans le plan les cellules sont appelées polygones de Voronoï ou polygones de Thiessen, et dans l’espace polyèdres de Voronoï.”</em></p>
<p>En savoir plus : <a href="https://fr.wikipedia.org/wiki/Diagramme_de_Vorono%C3%AF">Tesselation de Voronoi</a></p>
<p><a href="https://fr.wikipedia.org/wiki/Diagramme_de_Vorono%C3%AF#/media/Fichier:Coloured_Voronoi_2D.png"></a></p>
<p>Nous vous proposons de jouer avec les Voronoi sur ce site : <a href="https://interstices.info/jouez-avec-les-diagrammes-de-voronoi/">Jeu sur les voronois</a> . Lisez bien la consigne du jeu.</p>
</section>
<section id="découpage-géographique-grâce-au-diagramme-de-voronoi-en-r" class="level3">
<h3 class="anchored" data-anchor-id="découpage-géographique-grâce-au-diagramme-de-voronoi-en-r">Découpage géographique grâce au diagramme de Voronoi en R</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pour travailler sur des aspects géographiques dont les voronoi il faut passer du dataframe au géo dataframe</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># surfaces_ra1852_geo &lt;-</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_as_sf(</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     surfaces_ra1852_final %&gt;% drop_na(c(longitude, latitude)),</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     coords = c("longitude", "latitude"),</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     crs = 4326</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # on charge la projection pour le mettre en Lambert-93</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># surfaces_ra1852_geo &lt;- st_transform(surfaces_ra1852_geo, crs = 2154) </span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # On utilise les fonctions de sf</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># voronoi_surfaces_ra1852 &lt;- surfaces_ra1852_geo %&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_union() %&gt;% ## permet de passer une simple à un seul objet géométrique avec tous les points</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_voronoi() %&gt;% ## calcul du voronoi</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_collection_extract()  ## extraction en une liste avec les 363 figures géométriques</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Visualisation simple</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(voronoi_surfaces_ra1852)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="amélioration-du-découpage-géographique" class="level3">
<h3 class="anchored" data-anchor-id="amélioration-du-découpage-géographique">Amélioration du découpage géographique</h3>
<p>Dans le graphique généré dans le précédent chunk, on reconnait la France en zoomant. Mais la zone n’est pas limitée aux limites de la France. Donc il faut réduire le découpage à l’emprise de la France, pour ce faire :</p>
<ul>
<li>utiliser le fond des départements (<em>read_sf</em>, attention à la projection <strong>2154</strong>);</li>
<li>Appliquer un <em>st_union</em>, et réaliser une <em>st_intersection</em></li>
</ul>
<div class="cell">

</div>
</section>
</section>
<section id="visualisation-simple-des-données" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-simple-des-données">4 - Visualisation simple des données</h2>
<p>Nous avons un pavage de la France selon les chefs-lieux de canton et les données par canton. Nous pouvons visualiser les données grâce aux cartes directement en R.</p>
<section id="jointure-données-et-fond-géographique" class="level3">
<h3 class="anchored" data-anchor-id="jointure-données-et-fond-géographique">Jointure données et fond géographique</h3>
<p>Pour visualiser les données il faut joindre les données géographiques et les données du recensement de 1852.<br>
A vous de jouer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>voronoi_surfaces_final <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="fu">here</span>(<span class="st">"data/correction_dataframe_intermerdiaire/voronoi_surfaces_final.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cartes-en-r" class="level3">
<h3 class="anchored" data-anchor-id="cartes-en-r">Cartes en R</h3>
<p>Questions à se poser ?</p>
<ul>
<li>Quelles variables représenter ?</li>
<li>Quelles représentations ? (les ronds sont possibles, mais bon, vous n’avez pas créé des polygones pour rien)</li>
<li>Les pièges à éviter ?</li>
</ul>
<p>Quelques idées de carte à réaliser :</p>
<ul>
<li>Part des terres labourables par canton</li>
<li>Part des surfaces de céréales</li>
<li>Part des surfaces de vigne</li>
<li>Part des prairies artificielles</li>
</ul>
<p>A vous de jouer…</p>
<p>Pour apprendre à faire des cartes en R, vous pouvez consulter le site :</p>
<ul>
<li>en GGPLOT : <a href="https://maeltheuliere.github.io/rspatial/cr%C3%A9er-des-cartes-avec-ggplot-2.html">Site de Mael Theuliere - GGPlot</a><br>
</li>
<li>avec tmap : <a href="https://maeltheuliere.github.io/rspatial/cr%C3%A9er-des-cartes-avec-tmap.html">Site de Mael Theuliere - tmap</a></li>
<li>avec mapsf : <a href="https://riatelab.github.io/mapsf/">Documentation Mapsf</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################### A COMPLETER    #####################################################</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################################################### </span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################################################################################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="visualisation-avancée-des-données" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-avancée-des-données">5 - Visualisation avancée des données</h2>
<p>Maintenant que nous avons les données et que l’on sait faire des cartes, nous pouvons faire parler des données de 1852. Et nous vous proposons de créer une dataviz sur ces données. Plusieurs solutions :</p>
<ul>
<li>utiliser quarto
<ul>
<li>avantage : simplicité<br>
</li>
<li>inconvénient : manque d’interactivité<br>
</li>
</ul></li>
<li>créer une application shiny
<ul>
<li>avantage : vrai application web avec mise en page sur mesure et interactivité<br>
</li>
<li>inconvénient : pas facile à prendre en main et nécessite un serveur web pour publier</li>
</ul></li>
<li>créer une page dans Observable
<ul>
<li>avantage : page web interactive accessible sur internet<br>
</li>
<li>inconvénient : pas de données privées; apprentissage d’un nouveau langage (mais assez facile à prendre en main avec les aides à la saisie en ligne)</li>
</ul></li>
</ul>
<p>A vous de choisir !</p>
<p>Si vous souhaitez étoffer votre dataviz, n’hésitez pas à aller piocher dans les données autres que surfaces. Dans data/donnees_detaillees_ra_1852, vous trouverez la description globale des données du ra_1852 ainsi que les données sur les animaux, les céréales, les cultures diverses, l’économie rurale et la sériculture.</p>
<p>Ici nous vous accompagnerons dans la prise en main d’Observable.</p>
<section id="présentation-dobservable" class="level3">
<h3 class="anchored" data-anchor-id="présentation-dobservable">Présentation d’Observable</h3>
<p>Observable peut être utilisé de 2 manières : dans le site <a href="https://observablehq.com/">Observable</a> ou dans un outil de développement (pour nous en quarto on peut faire des chunks observable). Parlons dans un premier temps du site internet. Observable permet de créer des notebooks permettant d’explorer et visualiser les données.</p>
<p>L’utilisation d’observable est gratuite mais sans compte payant tous vos notebooks (et donc toutes vos données) seront accessibles publiquement sur internet. Aucune donnée confidentielle ne doit être utilisée dans le site observable.</p>
<p>Les notebooks d’observable peuvent être partagées avec d’autres utilisateurs. La collaboration est facilitée, sur le même document ou en créant des nouveaux notebooks en copiant le notebook initial (fork).</p>
<p>Les graphiques créés dans Observable peuvent être exportés en png ou svg. C’est idéal pour être réutilisé dans un site web ou dans une publication papier.</p>
<p>Quelques exemples de notebooks :</p>
<ul>
<li><a href="https://observablehq.com/d/6c17f4b11c38626e">Supreme Court Justice Nominations</a></li>
<li><a href="https://observablehq.com/@simon-pinkmartini/inflation-explorer">Inflation explorer</a></li>
<li><a href="https://observablehq.com/@strzepek/food-access">Food access</a></li>
</ul>
<p>Et bien sûr notre magnifique notebook :<br>
- <a href="https://observablehq.com/d/77608b46bd1e756c">Le recensement agricole de 1852</a></p>
<p>Pour utiliser Observable, il faut se créer un compte. Pour cela il faut cliquer sur <em>Sign up</em> sur la page <a href="https://observablehq.com/">Observable</a> .</p>
</section>
<section id="prise-en-main" class="level3">
<h3 class="anchored" data-anchor-id="prise-en-main">Prise en main</h3>
<p>Suite à la création de votre compte, il vous est proposé un cursus de formation/prise en main. Nous vous recommandons de suivre ce cursus. Vous créerez vos premiers notebooks. Dès que vous êtes suffisamment avancés, vous pourrer passer à la création de votre première page sur le recensement 1852.</p>
<p>Sinon il est possible de faire quelques <a href="https://observablehq.com/tutorials">tutoriels</a> et de consulter la <a href="https://observablehq.com/@observablehq/documentation">documentation</a>.</p>
</section>
<section id="création-dune-page-observable-sur-le-recensement-1852" class="level3">
<h3 class="anchored" data-anchor-id="création-dune-page-observable-sur-le-recensement-1852">Création d’une page observable sur le recensement 1852</h3>
<p>Nous vous proposons de créer un page sur le recensement de 1852 avec pour objectifs :</p>
<ul>
<li>de recréer les cartes R en Observable</li>
<li>d’apporter un peu de réactivité<br>
</li>
<li>de créer des graphiques D3</li>
</ul>
<section id="etape-1---import-des-données" class="level4">
<h4 class="anchored" data-anchor-id="etape-1---import-des-données">Etape 1 - import des données</h4>
<p>Après avoir créé votre notebook, vous importez vos tableaux de données travaillés précédemment.</p>
</section>
<section id="etape-2---créer-une-première-carte-avec-bertinjs" class="level4">
<h4 class="anchored" data-anchor-id="etape-2---créer-une-première-carte-avec-bertinjs">Etape 2 - créer une première carte avec bertinjs</h4>
<p>Nous vous proposons d’utiliser Bertin.js créé par Nicolas Lambert du CNRS. Pour apprendre à utiliser bertin, vous pouvez lire la page : <a href="https://observablehq.com/@neocartocnrs/hello-bertin-js?collection=@neocartocnrs/bertin">Hello bertin</a>.</p>
<p>Nous souhaitons créer des cartes choropleth, aussi nous vous conseillons de consulter la page <a href="https://observablehq.com/@neocartocnrs/bertin-js-chropoleth?collection=@neocartocnrs/bertin">Bertin.js: choropleth</a>.</p>
<p>Maintenant à vous de jouer pour créer votre première carte, par exemple la carte de terres labourables.</p>
</section>
<section id="etape-3---apporter-de-la-réactivité" class="level4">
<h4 class="anchored" data-anchor-id="etape-3---apporter-de-la-réactivité">Etape 3 - apporter de la réactivité</h4>
<p>C’est super, nous avons une belle carte en bertinjs. Maintenant ajoutons un peu d’interactivité. Par exemple nous pourrions ajouter une liste déroulante avec le type de cultures. En choisissant l’activité, la carte change.</p>
<p>A vous de jouer.</p>
<p>En cas de difficulté, vous pouvez consulter la doc sur les <a href="https://observablehq.com/@observablehq/inputs?collection=@observablehq/notebook-fundamentals">inputs</a> ou regarder notre notebook sur <a href="https://observablehq.com/d/77608b46bd1e756c">Le recensement agricole de 1852</a>.</p>
</section>
<section id="etape-4---créer-des-graphiques-d3" class="level4">
<h4 class="anchored" data-anchor-id="etape-4---créer-des-graphiques-d3">Etape 4 - créer des graphiques D3</h4>
<p>Pourquoi pas créer un graphique d3 ?</p>
<p>Choisissez votre graphique sur la page sur <a href="https://observablehq.com/@d3/gallery?collection=@observablehq/observable-libraries-for-visualization">D3 Gallery</a></p>
<p>Essayez ensuite de télécharger le graphique en png et svg.</p>
</section>
</section>
<section id="création-dun-chunk-observable-en-r" class="level3">
<h3 class="anchored" data-anchor-id="création-dun-chunk-observable-en-r">Création d’un chunk observable en R</h3>
<p>Maintenant que vous aimez faire des graphiques et des cartes en observable. C’est très utile quand vous avez à travailler sur des données privées.</p>
<p>Pour cela il suffit de créer un chunk {ojs}. La lecture de la documentation <a href="https://quarto.org/docs/interactive/ojs/">Quarto - Observable JS</a> peut être utile.</p>
<p>Vous pouvez par exemple essayer de créer un chunk avec une carte bertinjs. Consulter la documentation ici : <a href="https://neocarto.github.io/bertin/examples/quarto.html">Let’s make maps with bertin.js in Quarto</a></p>
<p><em>Attention l’évaluation d’un chunk de type ojs ne fonctionne pas en faisant un run du chunk… Il faut faire un Render pour évaluer le chunk ojs.</em></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



<script src="funathon_agriculture_histoire_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>